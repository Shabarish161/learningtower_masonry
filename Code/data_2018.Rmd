---
title: "PISA 2018 Data Import and Manipulation"
author: "Kim Fitter"
date: "12/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(here)
library(tidyverse)
library(haven)
```

Use the Haven package to read in the SPSS files.

```{r read in spss sav files}
urls <- read_csv(here("/Code/download_urls.csv")) %>% 
  filter(year==2018)

# View the files and url links to be imported for 2018
urls

# Import Student questionnaire data files with selected variables
stu_qqq <- read_sav(here("/Data/Raw/2018/CY07_MSU_STU_QQQ.sav"),
    col_select = c(CNT,
         CNTSCHID,
         CNTSTUID,
         ST005Q01TA,
         ST007Q01TA,
         ST004D01T,
         ST011Q04TA,
         ST011Q06TA,
         PV1MATH,
         PV1READ,
         PV1SCIE,
         W_FSTUWT))

# School questionnaire data file
sch_qqq <- read_sav(here("/Data/Raw/2018/CY07_MSU_SCH_QQQ.sav"),n_max = 10)
# Cognitive item data file
stu_cog <- read_sav(here("/Data/Raw/2018/CY07_MSU_STU_COG.sav"),n_max=10) 
#  Questionnaire timing data files 
stu_tim <- read_sav(here("/Data/Raw/2018/CY07_MSU_STU_TIM.sav"),n_max = 10)
# Teacher questionnaire data file
tch_qqq <- read_sav(here("/Data/Raw/2018/CY07_MSU_TCH_QQQ.sav"),n_max = 10)
# Additional data file for Viet Nam
vnm_stu_cog <- read_sav(here("/Data/Raw/2018/CY07_VNM_STU_COG.sav"),n_max = 10)
vnm_stu_pvs <- read_sav(here("/Data/Raw/2018/CY07_VNM_STU_PVS.sav"),n_max = 10)
```


```{r view summary}
skimr::skim(stu_qqq) 
```


```{r save files output}
# Student questionnaire data files
save(stu_qqq, file= here("/Data/Output/2018/CY07_MSU_STU_QQQ.rda"))
# School questionnaire data file
save(sch_qqq,file=here("/Data/Output/2018/CY07_MSU_SCH_QQQ.rda"))
# Cognitive item data file
save(stu_cog, file=here("/Data/Output/2018/CY07_MSU_STU_COG.rda"))
#  Questionnaire timing data files 
save(stu_tim , file= here("/Data/Output/2018/CY07_MSU_STU_TIM.rda"))
# Teacher questionnaire data file
save(tch_qqq, file=here("/Data/Output/2018/CY07_MSU_TCH_QQQ.rda"))
# Additional data file for Viet Nam
save(vnm_stu_cog, file=(here("/Data/Output/2018/CY07_VNM_STU_COG.rda")))
save(vnm_stu_pvs,file=here("/Data/Output/2018/CY07_VNM_STU_PVS.rda"))
```



